SELECT 
	state,
	city,
	make,
	ttl
FROM
(SELECT 
	evp.state,
	evp.city,
	evp.make,
	COUNT(model) as ttl,
	ROW_NUMBER() over (PARTITION BY evp.city ORDER BY COUNT( distinct evp."VIN (1-10)") DESC) as rnk
FROM 
Electric_Vehicle_Population evp 
GROUP BY
	evp.state,
	evp.city,
	evp.make,
	evp.model) AS ev_by_city
WHERE rnk = 1 
ORDER BY state, rnk asc
